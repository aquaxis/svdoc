<mxfile host="app.diagrams.net" modified="2026-02-16" type="device">
  <diagram id="ch14_dpi_build" name="DPI-Cビルドフロー">
    <mxGraphModel dx="1200" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <!-- タイトル -->
        <mxCell id="2" value="DPI-C ビルドフロー（コンパイル・リンク・実行）" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=18;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="20" width="560" height="40" as="geometry" />
        </mxCell>

        <!-- ========== Step 1: ソースファイル ========== -->
        <mxCell id="10" value="&lt;b&gt;Step 1: ソースファイル準備&lt;/b&gt;" style="text;html=1;align=left;fontSize=13;fontStyle=1;fontColor=#333333;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="250" height="25" as="geometry" />
        </mxCell>

        <!-- C source file -->
        <mxCell id="11" value="&lt;b&gt;my_func.c&lt;/b&gt;&lt;br&gt;（Cソースファイル）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="105" width="180" height="50" as="geometry" />
        </mxCell>
        <!-- svdpi.h header -->
        <mxCell id="12" value="&lt;b&gt;svdpi.h&lt;/b&gt;&lt;br&gt;（DPI標準ヘッダ）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="105" width="180" height="50" as="geometry" />
        </mxCell>
        <!-- SV source file -->
        <mxCell id="13" value="&lt;b&gt;design.sv&lt;/b&gt;&lt;br&gt;（SVソースファイル）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="480" y="105" width="180" height="50" as="geometry" />
        </mxCell>

        <!-- C source code annotation -->
        <mxCell id="14" value="#include &lt;svdpi.h&gt;&lt;br&gt;int c_calc(int a) {&lt;br&gt;    return a * 2;&lt;br&gt;}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#82b366;fontSize=10;fontFamily=Courier New;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="165" width="180" height="65" as="geometry" />
        </mxCell>
        <!-- SV source code annotation -->
        <mxCell id="15" value="import &quot;DPI-C&quot;&lt;br&gt;function int c_calc(int a);&lt;br&gt;&lt;br&gt;initial $display(c_calc(5));" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EBF5FB;strokeColor=#6c8ebf;fontSize=10;fontFamily=Courier New;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="480" y="165" width="220" height="65" as="geometry" />
        </mxCell>

        <!-- ========== Step 2: コンパイル ========== -->
        <mxCell id="20" value="&lt;b&gt;Step 2: Cコンパイル&lt;/b&gt;" style="text;html=1;align=left;fontSize=13;fontStyle=1;fontColor=#333333;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="40" y="260" width="250" height="25" as="geometry" />
        </mxCell>

        <!-- gcc compile command -->
        <mxCell id="21" value="&lt;b&gt;gcc -c -fPIC -I$VCS_HOME/include my_func.c&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontFamily=Courier New;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="295" width="400" height="35" as="geometry" />
        </mxCell>

        <!-- Object file output -->
        <mxCell id="22" value="&lt;b&gt;my_func.o&lt;/b&gt;&lt;br&gt;（オブジェクトファイル）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="290" width="180" height="45" as="geometry" />
        </mxCell>

        <!-- Arrow: sources → compile → object -->
        <mxCell id="23" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#333333;endArrow=classic;" edge="1" source="11" target="21" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="130" y="260" />
              <mxPoint x="130" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="24" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#333333;endArrow=classic;" edge="1" source="21" target="22" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ========== Step 3: 共有ライブラリ生成 ========== -->
        <mxCell id="30" value="&lt;b&gt;Step 3: 共有ライブラリ生成&lt;/b&gt;" style="text;html=1;align=left;fontSize=13;fontStyle=1;fontColor=#333333;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="40" y="365" width="250" height="25" as="geometry" />
        </mxCell>

        <!-- gcc shared command -->
        <mxCell id="31" value="&lt;b&gt;gcc -shared -o my_func.so my_func.o&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontFamily=Courier New;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="400" width="400" height="35" as="geometry" />
        </mxCell>

        <!-- Shared library output -->
        <mxCell id="32" value="&lt;b&gt;my_func.so&lt;/b&gt;&lt;br&gt;（共有ライブラリ）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="395" width="180" height="45" as="geometry" />
        </mxCell>

        <!-- Arrow: object → link → shared library -->
        <mxCell id="33" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#333333;endArrow=classic;" edge="1" source="22" target="31" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="590" y="370" />
              <mxPoint x="240" y="370" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="34" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#333333;endArrow=classic;" edge="1" source="31" target="32" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ========== Step 4: シミュレータ実行 ========== -->
        <mxCell id="40" value="&lt;b&gt;Step 4: シミュレーション実行&lt;/b&gt;" style="text;html=1;align=left;fontSize=13;fontStyle=1;fontColor=#333333;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="40" y="470" width="250" height="25" as="geometry" />
        </mxCell>

        <!-- Simulator box -->
        <mxCell id="41" value="&lt;b&gt;シミュレータ&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="505" width="200" height="50" as="geometry" />
        </mxCell>

        <!-- Simulator commands -->
        <mxCell id="42" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="40" y="570" width="680" height="90" as="geometry" />
        </mxCell>
        <mxCell id="43" value="&lt;b&gt;シミュレータ別コマンド例:&lt;/b&gt;" style="text;html=1;align=left;fontSize=11;fontStyle=1;fontColor=#333333;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="55" y="575" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="44" value="VCS:    vcs -sverilog design.sv -LDFLAGS '-L. -lmy_func'" style="text;html=1;align=left;fontSize=10;fontFamily=Courier New;fontColor=#666666;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="55" y="598" width="450" height="18" as="geometry" />
        </mxCell>
        <mxCell id="45" value="Xcelium: xrun design.sv -sv_lib ./my_func.so" style="text;html=1;align=left;fontSize=10;fontFamily=Courier New;fontColor=#666666;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="55" y="618" width="450" height="18" as="geometry" />
        </mxCell>
        <mxCell id="46" value="QuestaSim: vsim -sv_lib ./my_func design_tb" style="text;html=1;align=left;fontSize=10;fontFamily=Courier New;fontColor=#666666;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="55" y="638" width="450" height="18" as="geometry" />
        </mxCell>

        <!-- Arrows: SV + .so → Simulator -->
        <mxCell id="47" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#6c8ebf;endArrow=classic;" edge="1" source="13" target="41" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="470" />
              <mxPoint x="380" y="470" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="48" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#d6b656;endArrow=classic;" edge="1" source="32" target="41" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="590" y="480" />
              <mxPoint x="380" y="480" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Output -->
        <mxCell id="50" value="&lt;b&gt;シミュレーション実行結果&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=13;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="780" y="505" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="51" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#333333;endArrow=classic;" edge="1" source="41" target="50" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ========== フロー全体の矢印ラベル ========== -->
        <mxCell id="60" value=".c + .h" style="text;html=1;align=center;fontSize=10;fontColor=#82b366;fontStyle=2;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="90" y="240" width="60" height="18" as="geometry" />
        </mxCell>
        <mxCell id="61" value=".o" style="text;html=1;align=center;fontSize=10;fontColor=#6c8ebf;fontStyle=2;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="590" y="345" width="40" height="18" as="geometry" />
        </mxCell>
        <mxCell id="62" value=".so" style="text;html=1;align=center;fontSize=10;fontColor=#d6b656;fontStyle=2;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="610" y="455" width="40" height="18" as="geometry" />
        </mxCell>
        <mxCell id="63" value=".sv" style="text;html=1;align=center;fontSize=10;fontColor=#6c8ebf;fontStyle=2;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="530" y="455" width="40" height="18" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
