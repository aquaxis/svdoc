<mxfile host="app.diagrams.net" modified="2026-02-16T00:00:00.000Z" agent="Mozilla/5.0" version="22.1.0">
  <diagram name="Page-1" id="ch16_fsm">
    <mxGraphModel dx="1200" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <!-- Title -->
        <mxCell id="2" value="&lt;b&gt;FSMの2プロセスパターン&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="300" height="40" as="geometry"/>
        </mxCell>
        <!-- Process 1: State Register (Blue) -->
        <mxCell id="10" value="&lt;b&gt;プロセス1: 状態レジスタ&lt;br&gt;(always_ff)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="60" y="100" width="280" height="200" as="geometry"/>
        </mxCell>
        <mxCell id="11" value="&lt;font face=&quot;monospace&quot;&gt;always_ff @(posedge clk&lt;br&gt;          or negedge rst_n)&lt;br&gt;  if (!rst_n)&lt;br&gt;    current_state &amp;lt;= IDLE;&lt;br&gt;  else&lt;br&gt;    current_state &amp;lt;= next_state;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;verticalAlign=middle;opacity=50;" vertex="1" parent="1">
          <mxGeometry x="80" y="160" width="240" height="120" as="geometry"/>
        </mxCell>
        <!-- Process 2: Next State / Output Logic (Green) -->
        <mxCell id="20" value="&lt;b&gt;プロセス2: 次状態・出力論理&lt;br&gt;(always_comb)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="780" y="100" width="320" height="200" as="geometry"/>
        </mxCell>
        <mxCell id="21" value="&lt;font face=&quot;monospace&quot;&gt;always_comb begin&lt;br&gt;  next_state = current_state;&lt;br&gt;  ctrl = '0;&lt;br&gt;  case (current_state)&lt;br&gt;    IDLE:   ...&lt;br&gt;    RUN:    ...&lt;br&gt;    WAIT:   ...&lt;br&gt;    FINISH: ...&lt;br&gt;  endcase&lt;br&gt;end&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;verticalAlign=middle;opacity=50;" vertex="1" parent="1">
          <mxGeometry x="800" y="150" width="280" height="140" as="geometry"/>
        </mxCell>
        <!-- Arrows between processes -->
        <mxCell id="30" value="&lt;b&gt;next_state&lt;/b&gt;" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#82b366;html=1;" edge="1" parent="1">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint x="780" y="170" as="sourcePoint"/>
            <mxPoint x="340" y="170" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="31" value="&lt;b&gt;current_state&lt;/b&gt;" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#6c8ebf;html=1;" edge="1" parent="1">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint x="340" y="230" as="sourcePoint"/>
            <mxPoint x="780" y="230" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <!-- Input arrows -->
        <mxCell id="32" value="&lt;b&gt;clk&lt;/b&gt;" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#333333;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="60" y="160" as="targetPoint"/>
            <mxPoint x="0" y="160" as="sourcePoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="33" value="&lt;b&gt;rst_n&lt;/b&gt;" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#333333;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="60" y="200" as="targetPoint"/>
            <mxPoint x="0" y="200" as="sourcePoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="34" value="&lt;b&gt;start&lt;/b&gt;" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#333333;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1100" y="160" as="targetPoint"/>
            <mxPoint x="1160" y="160" as="sourcePoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="35" value="&lt;b&gt;done&lt;/b&gt;" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#333333;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1100" y="200" as="targetPoint"/>
            <mxPoint x="1160" y="200" as="sourcePoint"/>
          </mxGeometry>
        </mxCell>
        <!-- Output arrow -->
        <mxCell id="36" value="&lt;b&gt;ctrl&lt;/b&gt;" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#333333;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1100" y="270" as="sourcePoint"/>
            <mxPoint x="1160" y="270" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <!-- State Diagram in center -->
        <mxCell id="40" value="&lt;b&gt;状態遷移図&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];strokeColor=none;fillColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="460" y="350" width="120" height="30" as="geometry"/>
        </mxCell>
        <!-- IDLE state -->
        <mxCell id="41" value="&lt;b&gt;IDLE&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="340" y="400" width="90" height="50" as="geometry"/>
        </mxCell>
        <!-- RUN state -->
        <mxCell id="42" value="&lt;b&gt;RUN&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="510" y="400" width="90" height="50" as="geometry"/>
        </mxCell>
        <!-- WAIT state -->
        <mxCell id="43" value="&lt;b&gt;WAIT&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="680" y="400" width="90" height="50" as="geometry"/>
        </mxCell>
        <!-- FINISH state -->
        <mxCell id="44" value="&lt;b&gt;FINISH&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="510" y="510" width="90" height="50" as="geometry"/>
        </mxCell>
        <!-- State transitions -->
        <mxCell id="50" value="start" style="endArrow=block;endFill=1;strokeWidth=1;strokeColor=#666666;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" source="41" target="42" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="51" value="" style="endArrow=block;endFill=1;strokeWidth=1;strokeColor=#666666;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" source="42" target="43" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="52" value="done" style="endArrow=block;endFill=1;strokeWidth=1;strokeColor=#666666;html=1;exitX=0.5;exitY=1;entryX=1;entryY=0.5;" edge="1" source="43" target="44" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="53" value="" style="endArrow=block;endFill=1;strokeWidth=1;strokeColor=#666666;html=1;exitX=0;exitY=0.5;entryX=0.5;entryY=1;" edge="1" source="44" target="41" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <!-- Annotation box -->
        <mxCell id="60" value="&lt;b&gt;メリット&lt;/b&gt;&lt;br&gt;・順序回路と組み合わせ回路の明確な分離&lt;br&gt;・ラッチ推論の防止&lt;br&gt;・デバッグが容易" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="60" y="380" width="260" height="100" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
