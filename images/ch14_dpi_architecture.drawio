<mxfile host="app.diagrams.net" modified="2026-02-16" type="device">
  <diagram id="ch14_dpi_arch" name="DPI-Cのアーキテクチャ">
    <mxGraphModel dx="1200" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <!-- タイトル -->
        <mxCell id="2" value="DPI-C（Direct Programming Interface）のアーキテクチャ" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=18;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- ========== SystemVerilog側（左） ========== -->
        <mxCell id="10" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;opacity=30;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="320" height="340" as="geometry" />
        </mxCell>
        <mxCell id="11" value="&lt;b&gt;SystemVerilog側&lt;/b&gt;" style="text;html=1;align=center;fontSize=14;fontStyle=1;fontColor=#6c8ebf;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="100" y="85" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- SV Testbench -->
        <mxCell id="12" value="&lt;b&gt;SV Testbench&lt;/b&gt;&lt;br&gt;（テストベンチ）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="130" width="240" height="50" as="geometry" />
        </mxCell>
        <!-- SV Module -->
        <mxCell id="13" value="&lt;b&gt;SV Module&lt;/b&gt;&lt;br&gt;（設計モジュール）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=13;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="200" width="240" height="50" as="geometry" />
        </mxCell>
        <!-- import declaration -->
        <mxCell id="14" value="import &quot;DPI-C&quot;&lt;br&gt;function int c_calc(int a);" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EBF5FB;strokeColor=#6c8ebf;fontSize=11;fontFamily=Courier New;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="80" y="270" width="240" height="45" as="geometry" />
        </mxCell>
        <!-- export declaration -->
        <mxCell id="15" value="export &quot;DPI-C&quot;&lt;br&gt;function void sv_callback();" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EBF5FB;strokeColor=#6c8ebf;fontSize=11;fontFamily=Courier New;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="80" y="330" width="240" height="45" as="geometry" />
        </mxCell>

        <!-- ========== DPI-C Layer（中央） ========== -->
        <mxCell id="20" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;opacity=40;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="400" y="80" width="200" height="340" as="geometry" />
        </mxCell>
        <mxCell id="21" value="&lt;b&gt;DPI-C Layer&lt;/b&gt;" style="text;html=1;align=center;fontSize=14;fontStyle=1;fontColor=#d6b656;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="425" y="85" width="150" height="30" as="geometry" />
        </mxCell>
        <!-- Import Interface -->
        <mxCell id="22" value="&lt;b&gt;Import Interface&lt;/b&gt;&lt;br&gt;（SV → C 呼び出し）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="420" y="160" width="160" height="60" as="geometry" />
        </mxCell>
        <!-- Export Interface -->
        <mxCell id="23" value="&lt;b&gt;Export Interface&lt;/b&gt;&lt;br&gt;（C → SV 呼び出し）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="420" y="260" width="160" height="60" as="geometry" />
        </mxCell>
        <!-- svdpi.h -->
        <mxCell id="24" value="&lt;b&gt;svdpi.h&lt;/b&gt;&lt;br&gt;標準ヘッダファイル" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="430" y="350" width="140" height="50" as="geometry" />
        </mxCell>

        <!-- ========== C/C++側（右） ========== -->
        <mxCell id="30" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;opacity=30;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="640" y="80" width="320" height="340" as="geometry" />
        </mxCell>
        <mxCell id="31" value="&lt;b&gt;C/C++側&lt;/b&gt;" style="text;html=1;align=center;fontSize=14;fontStyle=1;fontColor=#82b366;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="730" y="85" width="150" height="30" as="geometry" />
        </mxCell>

        <!-- C Functions -->
        <mxCell id="32" value="&lt;b&gt;C Functions&lt;/b&gt;&lt;br&gt;（ユーザ定義C関数）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="130" width="240" height="50" as="geometry" />
        </mxCell>
        <!-- C Libraries -->
        <mxCell id="33" value="&lt;b&gt;C/C++ Libraries&lt;/b&gt;&lt;br&gt;（外部ライブラリ: OpenSSL, SQLite等）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="200" width="240" height="50" as="geometry" />
        </mxCell>
        <!-- C implementation -->
        <mxCell id="34" value="int c_calc(int a) {&lt;br&gt;    return a * 2;&lt;br&gt;}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#82b366;fontSize=11;fontFamily=Courier New;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="680" y="270" width="240" height="55" as="geometry" />
        </mxCell>
        <!-- C calling SV -->
        <mxCell id="35" value="extern void sv_callback();&lt;br&gt;// C側から呼び出し可能" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#82b366;fontSize=11;fontFamily=Courier New;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="680" y="340" width="240" height="45" as="geometry" />
        </mxCell>

        <!-- ========== フロー矢印 ========== -->
        <!-- SV → Import Interface -->
        <mxCell id="40" value="import: SVからCを呼び出し" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#d6b656;endArrow=classic;fontSize=10;fontColor=#d6b656;fontStyle=1;" edge="1" source="14" target="22" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <!-- Import Interface → C -->
        <mxCell id="41" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#82b366;endArrow=classic;" edge="1" source="22" target="34" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <!-- C → Export Interface -->
        <mxCell id="42" value="export: CからSVを呼び出し" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#d6b656;endArrow=classic;fontSize=10;fontColor=#d6b656;fontStyle=1;" edge="1" source="35" target="23" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <!-- Export Interface → SV -->
        <mxCell id="43" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;strokeColor=#6c8ebf;endArrow=classic;" edge="1" source="23" target="15" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ========== 比較ノートボックス ========== -->
        <mxCell id="50" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FAFAFA;strokeColor=#CCCCCC;" vertex="1" parent="1">
          <mxGeometry x="40" y="460" width="920" height="140" as="geometry" />
        </mxCell>
        <mxCell id="51" value="&lt;b&gt;DPI-C vs PLI/VPI 比較&lt;/b&gt;" style="text;html=1;align=center;fontSize=14;fontColor=#333333;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="465" width="300" height="25" as="geometry" />
        </mxCell>
        <!-- DPI-C advantages -->
        <mxCell id="52" value="&lt;b&gt;DPI-C（推奨）&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="60" y="498" width="180" height="35" as="geometry" />
        </mxCell>
        <mxCell id="53" value="• シンプルなAPI&lt;br&gt;• 高速な呼び出し（オーバーヘッド小）&lt;br&gt;• IEEE 1800標準準拠&lt;br&gt;• 型安全なインターフェース" style="text;html=1;align=left;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="60" y="538" width="200" height="55" as="geometry" />
        </mxCell>
        <!-- PLI/VPI -->
        <mxCell id="54" value="&lt;b&gt;PLI/VPI（レガシー）&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="300" y="498" width="180" height="35" as="geometry" />
        </mxCell>
        <mxCell id="55" value="• 複雑なAPI（コールバック方式）&lt;br&gt;• オーバーヘッドが大きい&lt;br&gt;• IEEE 1364ベース&lt;br&gt;• シミュレータ内部にアクセス可能" style="text;html=1;align=left;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="300" y="538" width="210" height="55" as="geometry" />
        </mxCell>
        <!-- Key differences -->
        <mxCell id="56" value="&lt;b&gt;使い分け指針&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="560" y="498" width="180" height="35" as="geometry" />
        </mxCell>
        <mxCell id="57" value="• 新規開発 → DPI-Cを使用&lt;br&gt;• シミュレータ内部操作 → VPIを使用&lt;br&gt;• 性能重視 → DPI-Cが有利&lt;br&gt;• レガシーコード → VPIのまま維持" style="text;html=1;align=left;fontSize=10;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="560" y="538" width="210" height="55" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
